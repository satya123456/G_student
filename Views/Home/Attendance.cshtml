@model Gstudent.ViewModels.Studentrecords.Attendancesummary

<style>
    .circle {
        border-radius: 50%;
        border: 5px solid #5f6b9b;
        margin: 20px auto;
        width: 150px;
        height: 150px;
        position: relative;
    }
    .highcharts-title {
        font-size: 45px !important;
        /*color: rgb(0 161 27) !important;*/
        color: rgb(33, 150, 243) !important;
        font-weight: bold !important;
        /* fill: rgb(0 161 27) !important;*/
        fill: rgb(33, 150, 243) !important;
    }

  
</style>
@if (Model.notes.Count() > 0)
{
    <input type="text" value="@Model.notes.FirstOrDefault().percentage" id="userId" hidden />

}
else
{
    <input type="text" value="0" id="userId" hidden />
}

<section class="content-container contentContainer">

    <div class="tabsContainer  ">

        <!-- Tabs line -->
        <div class="tabsFill">
            <div class="d-flex justify-content-between">
                <h3 class="page-title">Attendance
                    <div class="back pull-right">
                        <a href="javascript:void(0);" onclick="location.reload();">
                            <i class='bx bx-arrow-back'></i>
                        </a>
                    </div>
                </h3>
                <!-- Nav tabs -->
                <ul class="nav nav-tabs">
                    @*<li class="nav-item" onclick="summerterm();">
                        <a class="nav-link " data-bs-toggle="tab" onclick="summerterm();" href="#tab6">Summerterm</a>
                    </li>*@
                    <li class="nav-item" onclick="Today();">
                        <a class="nav-link " data-bs-toggle="tab" onclick="Today();" href="#tab5">Today</a>
                    </li>
                    <li class="nav-item" onclick="Yesterday();">
                        <a class="nav-link" data-bs-toggle="tab" onclick="Yesterday();" href="#tab1">Yesterday</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " data-bs-toggle="tab" onclick="handleInitialClick();" href="#tab2" name="daterange" id="dateRangePicker" text="Calender">Calender <i class="ri-calendar-line"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="tab" href="#tab3">Semester</a>
                    </li>

                  

                </ul>
            </div>
            <div class="box-container">
                <!-- Tab panes -->

                <div class="tab-content">
                    <div class="tab-pane " id="tab6">
                        <div id="available6">

                        </div>
                    </div>
                    <div class="tab-pane" id="tab1">
                        <div id="available3">

                        </div>
                    </div>
                    <div class="tab-pane " id="tab5">
                        <div id="available5">

                        </div>
                    </div>
                    <div class="tab-pane" id="tab2">
                        <div id="available1">

                        </div>
                    </div>
                    <div class="tab-pane  active" id="tab3">
                        <div class="filter" id="executive">
                            @*@if (Session["Curr_sem"].ToString() == "2")
                {
                    if (Session["campus_code"].ToString() != "BLR")
                    {
                        <p>
                            <b>Note : </b> Attendance calculation for 2nd semester starts from 09 December 2023.
                        </p>
                    }
                    else
                    {
                        <p>
                            <b>Note : </b> Attendance calculation for 2nd semester starts from 12 December 2023.
                        </p>
                    }
                }

                @if (Session["Curr_sem"].ToString() == "4")
                {
                    <p>
                        <b>Note : </b> Attendance calculation for 4th semester starts from 06 December 2023.
                    </p>
                }
                else if (Session["Curr_sem"].ToString() == "6")
                {
                    <p>
                        <b>Note : </b> Attendance calculation for 6th semester starts from 06 December 2023.
                    </p>
                }
                else if (Session["Curr_sem"].ToString() == "8")
                {
                    <p>
                        <b>Note : </b> Attendance calculation for 8th semester starts from 06 December 2023.
                    </p>
                }*@

                            <h5>Course wise percentage</h5>
                            <div id="available2" class="pt-2">

                            </div>
                            <div class="vital_signs_graph_view">

                                <div id="vital_chart" tabindex="1"></div>
                            </div>
                            <br>
                            <hr />
                            @if (Model.notes.Count() > 0)
                            {
                                <div class="col-md-3">
                                    <h5>Semester wise percentage</h5>
                                    <div id="piechart" style="min-width: 310px; height: 350px; max-width: 600px; margin: 0 auto"></div>
                                </div>
                            }
                            else
                            {
                                <h6 class="text-center">No data available</h6>

                            }
                        </div>




                    </div>
                    <div class="tab-pane " id="tab4">
                        <div class="filter  row" id="executive">


                        </div>
                    </div>


                </div>
            </div>

        </div>
    </div>


</section>
<script src="~/Scripts/highcharts.js"></script>
<script src="~/Scripts/exporting.js"></script>
<script>
    /*$('#datatable').DataTable();*/

    $(document).ready(function () {
        Today();
        handleInitialClick();
        //$('#myTable').DataTable({

        //});

        var date = new Date();
        date.setDate(date.getDate() - 0);
        $("#datetime-new-picker").datepicker({
            maxDate: 0,
            changeMonth: true,
            changeYear: true,
            yearRange: '1980:n',
            dateFormat: 'dd-M-yy',
            controlType: 'select'
        });
        //    $('.vital_signs_graph_view').hide();


        var val = 'subject';
        var mon = $("#datetime-new-picker").val();


        $.ajax({
            type: 'GET',
            url: "./Home/GetAttendancedatachart",
            datatype: JSON,
            data: {
                'category': val,
                'date': mon,
            },
            success: (function (response) {
                // $('#executive').hide();
                // $(".vital_signs_graph_view").hide();
                $('#available2').html("");
                $('#available2').html(response);
                $('#available2').show();
                if (response.trim() === '<div>No data available</div>') {
                }
                else {
                    $('#myTablevend').DataTable({
                    });
                }

            })
        });
    });




    $(function () {
        $('.highcharts-credits').hide();

        var percentage = parseFloat($("#userId").val());
        var roundedPercentage = percentage.toFixed(2);
        var roundedPercentageNumber = parseFloat(roundedPercentage);
        var absent = 100 - percentage;
        var roundedAbsent = absent.toFixed(2);
        var roundedAbsentNumber = parseFloat(roundedAbsent);
        //var absent = 100 - percentage;
        $('#piechart').highcharts({
           // colors: ['rgb(0 161 27)', 'rgb(255, 69, 96)'],
            colors: ['rgb(33, 150, 243)', 'rgb(255, 69, 96)'],
            title: {
                text: percentage + '%',
                verticalAlign: 'middle',
                fontSize: '45',
               @* legend: {
                    name: {
                        fontSize: '40px',
                    }
                },*@
               
                
            },
            plotOptions: {
                pie: {
                    dataLabels: {
                        enabled: false
                    },
                    borderWidth: 0,
                    style: { fontSize: '40px' }
                }
            },
            series: [{
                type: 'pie',
                name: 'Attendance',
                innerSize: '95%',
                data: [{
                    name: 'Present',
                    y: roundedPercentageNumber
                }, {
                    name: 'Absent',
                    y: roundedAbsentNumber
                }]
            }],
            accessibility: {
                enabled: true // Enable accessibility features
            },
            credits: {
                enabled: false
            },
            
        });

    });
</script>

<script>
    $(function () {
        $("#tabs-1").tabs();
    });
</script>
<script>
    function performAjaxRequest(label, mon) {


        var currentDate = new Date();
        $.ajax({
            type: 'GET',
            url: "./Home/GetAttendancedata",
            datatype: JSON,
            data: {
                'category': label,
                'date': mon,
            },
            success: (function (response) {

                $('#available1').html("");
                $('#available1').html(response);
                $('#available1').show();
                if (response.trim() === '<div>No data available</div>') {
                }
                else {
                    $('#myTablevend1').DataTable();

                }
            })
        });



    };
    var nowDate = new Date();

    today = nowDate.getDate() + '/' + nowDate.getMonth() + '/' + nowDate.getFullYear();

    $('#dateRangePicker').daterangepicker({

        //endDate:today,
        autoUpdateInput: false,
        showDropdowns: true,

        locale: {

            cancelLabel: 'Clear'
        },
        ranges: {

            /*   'Semester': [moment(), moment()],*/
            @*'Today': [moment(), moment()],*@

            'Last 7 Days': [moment().subtract(6, 'days'), moment()],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month': [moment().startOf('month'), moment().endOf('month')],
            'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        },

        linkedCalendars: false,
        maxDate: moment().endOf("day")

    }, function (start, end, label) {

        $('#dateRangePicker').val('Calendar');


        if (label == 'Today' || label == 'Yesterday') {
            $('#dateRangePicker').val(start.format('DD-MMM-YYYY'));
        }
        else if (label == 'Semester') {
            loadConfigView('2');
        }
        else {
            $('#dateRangePicker').val(start.format('DD-MM-YYYY') + ' to ' + end.format('DD-MM-YYYY'));

        }
        var val = label;
        var mon = $("#dateRangePicker").val();

        var dateText = $('#dateRangePicker').val();
        performAjaxRequest(val, mon);



    });


    function handleInitialClick() {

        var cal = $('#dateRangePicker').val();

        if (cal == "") {
            var currentDate = new Date();
            var Today = "Today";
            performAjaxRequest(Today, currentDate);
        }

    }
</script>
<script>
    function Yesterday() {

        var currentDate = new Date();
        $.ajax({
            type: 'GET',
            url: "./Home/GetAttendancedata",
            datatype: JSON,
            data: {
                'category': "Yesterday",
                'date': currentDate,
            },
            success: (function (response) {
                $('#available3').html("");
                $('#available3').html(response);
                $('#available3').show();
                if (response.trim() === '<div>No data available</div>') {
                }
                else {
                    $('#myTablevend2').DataTable({
                    });
                }
            })
        });
    };

    function Today() {

        var currentDate = new Date();
        $.ajax({
            type: 'GET',
            url: "./Home/GetAttendancedata",
            datatype: JSON,
            data: {
                'category': "Today",
                'date': currentDate,
            },
            success: (function (response) {
                $('#available5').html("");
                $('#available5').html(response);
                $('#available5').show();
                if (response.trim() === '<div>No data available</div>') {
                }
                else {
                    $('#myTablevend5').DataTable({
                    });
                }
            })
        });
    };
    function summerterm() {

        var currentDate = new Date();
        $.ajax({
            type: 'GET',
            url: "./Home/GetAttendancedata",
            datatype: JSON,
            data: {
                'category': "summerterm",
                'date': currentDate,
            },
            success: (function (response) {
                $('#available6').html("");
                $('#available6').html(response);
                $('#available6').show();
                if (response.trim() === '<div>No data available</div>') {
                }
                else {
                    $('#myTablevend6').DataTable({
                    });
                }
            })
        });
    };
</script>

